function isArray(n){return Object.prototype.toString.call(n)=="[object Array]"}function isFunction(n){return typeof n=="function"}function isNumber(n){return typeof n=="number"}function isString(n){return typeof n=="string"}function random(n,t){return isArray(n)?n[~~(Math.random()*n.length)]:(isNumber(t)||(t=n||1,n=0),n+Math.random()*(t-n))}var floor,Noc,$;window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();var imageToImageData=function(n){var t=document.createElement("canvas"),i;return t.width=n.width,t.height=n.height,i=t.getContext("2d"),i.drawImage(n,0,0),i.getImageData(0,0,n.width,n.height)},imageDataToArrayR=function(n){for(var i={width:n.width,height:n.height,data:[]},t=0;t<n.data.length/4;t++)i.data[t]=n.data[t*4];return i},imageDataToArray=function(n){for(var i={width:n.width,height:n.height,data:[]},t=0;t<n.data.length;t++)i.data[t]=n.data[t];return i};floor=function(n){return Math.floor(n)};Noc={Timer:{},Utils:{newGuid:function(n,t){for(t=n="";n++<36;t+=n*51&52?(n^15?8^Math.random()*(n^20?16:4):4).toString(16):"-");return t}},Collision:{},Communication:{}};Noc.Communication.XSocketsNET=function(){return function(){throw"Not yet implemented";}}();Noc.Utils.Delaunay=function(){function r(n){for(var r=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY,h,c,i,f,e,t=n.length;t--;)n[t][0]<r&&(r=n[t][0]),n[t][0]>o&&(o=n[t][0]),n[t][1]<u&&(u=n[t][1]),n[t][1]>s&&(s=n[t][1]);return h=o-r,c=s-u,i=Math.max(h,c),f=r+h*.5,e=u+c*.5,[[f-20*i,e-i],[f,e+20*i],[f+20*i,e-i]]}function i(t,i,r,u){var c=t[i][0],l=t[i][1],f=t[r][0],e=t[r][1],a=t[u][0],v=t[u][1],d=Math.abs(l-e),g=Math.abs(e-v),o,y,s,h,p,w,b,k,nt,tt;if(d<n&&g<n)throw new Error("Eek! Coincident points!");return d<n?(h=-((a-f)/(v-e)),w=(f+a)/2,k=(e+v)/2,o=(f+c)/2,y=h*(o-w)+k):g<n?(s=-((f-c)/(e-l)),p=(c+f)/2,b=(l+e)/2,o=(a+f)/2,y=s*(o-p)+b):(s=-((f-c)/(e-l)),h=-((a-f)/(v-e)),p=(c+f)/2,w=(f+a)/2,b=(l+e)/2,k=(e+v)/2,o=(s*p-h*w+k-b)/(s-h),y=d>g?s*(o-p)+b:h*(o-w)+k),nt=f-o,tt=e-y,{i:i,j:r,k:u,x:o,y:y,r:nt*nt+tt*tt}}function u(n){for(var i,r,u,f,e,t=n.length;t;)for(u=n[--t],r=n[--t],i=t;i;)if(e=n[--i],f=n[--i],r===f&&u===e||r===e&&u===f){n.splice(t,2);n.splice(i,2);break}}var n=1/1048576,t=function(){};return t.prototype.triangulate=function(t,f){var h=t.length,e,s,v,y,o,c,l,a,w,b,k,p;if(h<3)return[];if(t=t.slice(0),f)for(e=h;e--;)t[e]=t[e][f];for(v=new Array(h),e=h;e--;)v[e]=e;for(v.sort(function(n,i){return t[i][0]-t[n][0]}),y=r(t),t.push(y[0],y[1],y[2]),o=[i(t,h+0,h+1,h+2)],c=[],l=[],e=v.length;e--;l.length=0){for(p=v[e],s=o.length;s--;){if(a=t[p][0]-o[s].x,a>0&&a*a>o[s].r){c.push(o[s]);o.splice(s,1);continue}(w=t[p][1]-o[s].y,a*a+w*w-o[s].r>n)||(l.push(o[s].i,o[s].j,o[s].j,o[s].k,o[s].k,o[s].i),o.splice(s,1))}for(u(l),s=l.length;s;)k=l[--s],b=l[--s],o.push(i(t,b,k,p))}for(e=o.length;e--;)c.push(o[e]);for(o.length=0,e=c.length;e--;)c[e].i<h&&c[e].j<h&&c[e].k<h&&o.push(c[e].i,c[e].j,c[e].k);return o},t.prototype.pcontains=function(n,t){var i,r;if(t[0]<n[0][0]&&t[0]<n[1][0]&&t[0]<n[2][0]||t[0]>n[0][0]&&t[0]>n[1][0]&&t[0]>n[2][0]||t[1]<n[0][1]&&t[1]<n[1][1]&&t[1]<n[2][1]||t[1]>n[0][1]&&t[1]>n[1][1]&&t[1]>n[2][1])return null;var f=n[1][0]-n[0][0],e=n[2][0]-n[0][0],o=n[1][1]-n[0][1],s=n[2][1]-n[0][1],u=f*s-e*o;return u===0?null:(i=(s*(t[0]-n[0][0])-e*(t[1]-n[0][1]))/u,r=(f*(t[1]-n[0][1])-o*(t[0]-n[0][0]))/u,i<0||r<0||i+r>1)?null:[i,r]},t}();Noc.Helpers={flattenVerticles:function(n){return n.map(function(n){return[n.x,n.y]})},getVerticles:function(n,t){var i=[],r=t;return n.forEach(function(n){i.push(r[n])}),i},triangulate:function(n){return(new Noc.Utils.Delaunay).triangulate(n)},getFaces:function(n,t){for(var i=[];n.length;)i.push(n.splice(0,t));return i}};Noc.Point2D=function(){return function(n,t){this.x=n;this.y=t}}();Noc.Point3D=function(){return function(n,t,i){this.x=n||0;this.y=t||0;this.z=i||0;this.rotateX=function(n){var t,i,r,u,f;return t=n*Math.PI/180,i=Math.cos(t),r=Math.sin(t),u=this.y*i-this.z*r,f=this.y*r+this.z*i,new Noc.Point3D(this.x,u,f)};this.rotateY=function(n){var t,i,r,u,f;return t=n*Math.PI/180,i=Math.cos(t),r=Math.sin(t),f=this.z*i-this.x*r,u=this.z*r+this.x*i,new Noc.Point3D(u,this.y,f)};this.rotateZ=function(n){var t,i,r,u,f;return t=n*Math.PI/180,i=Math.cos(t),r=Math.sin(t),u=this.x*i-this.y*r,f=this.x*r+this.y*i,new Noc.Point3D(u,f,this.z)};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};this.scale=function(n){this.x*=n;this.y*=n;this.z*=n};this.normalize=function(){var n=this.length();return n!=0?(this.x/=n,this.y/=n,this.z/=n,!0):!1};this.angle=function(n){var i=new Noc.Point3D(this.x,this.y,this.z,this.u,this.v),t,r;return i.normalize(),t=new Noc.Point3D(n.x,n.y,n.z),t.normalize(),r=i.dot(t),Math.acos(r)};this.cross=function(n){var t=new Noc.Point3D(this.x,this.y,this.z,this.u,this.v);return t.x=this.y*n.z-this.z*n.y,t.y=this.z*n.x-this.x*n.z,t.z=this.x*n.y-this.y*n.x,t};this.dot=function(n){return this.x*n.x+this.y*n.y+this.z*n.z};this.project=function(n,t,i,r){var u,f,e;return u=i/(r+this.z),f=this.x*u+n/2,e=this.y*u+t/2,new Noc.Point3D(f,e,this.z)}}}();Noc.Object3D=function(){var n=function(n,t){this.verticles=n||[];this.uvs=[];this.faces=t||[];this.position={};this.scale=1;this.rotation={}};return n.prototype.flattenVerticles=function(){return Noc.Helpers.flattenVerticles(this.verticles)},n.prototype.getVerticles=function(n){return Noc.Helpers.getVerticles(n)},n.prototype.rotateX=function(n){for(var t=0;t<this.verticles.length;t++)this.verticles[t]=this.verticles[t].rotateX(n);return this},n.prototype.rotateY=function(n){for(var t=0;t<this.verticles.length;t++)this.verticles[t]=this.verticles[t].rotateY(n);return this},n.prototype.rotateZ=function(n){for(var t=0;t<this.verticles.length;t++)this.verticles[t]=this.verticles[t].rotateZ(n);return this},n.prototype.project=function(n,t,i,r){var u=[];return this.verticles.forEach(function(f){var e=f.project(n,t,i,r);u.push(e)}),u},n.prototype.setScale=function(){verticles.forEach(function(){})},n}();Noc.Texture={basicTexture:function(n,t,i){var r=document.createElement("canvas"),u;return r.width=n,r.height=t,u=r.getContext("2d"),u.fillStyle=i,u.fillRect(0,0,n,t),r}};Noc.Drawing=function(){var n=function(n){this.ctx=n};return n.prototype.drawTriangles=function(n,t,i){for(var u=this.ctx,k=0;k<i.length;k++){var r=i[k],l=t[r[0]].x,a=t[r[1]].x,v=t[r[2]].x,y=t[r[0]].y,p=t[r[1]].y,w=t[r[2]].y,f=t[r[0]].u,e=t[r[1]].u,o=t[r[2]].u,s=t[r[0]].v,h=t[r[1]].v,c=t[r[2]].v;u.save();u.beginPath();u.moveTo(l,y);u.lineTo(a,p);u.lineTo(v,w);u.closePath();u.clip();var b=f*h+s*o+e*c-h*o-s*e-f*c,d=l*h+s*v+a*c-h*v-s*a-l*c,g=f*a+l*o+e*v-a*o-l*e-f*v,nt=f*h*v+s*a*o+l*e*c-l*h*o-s*e*v-f*a*c,tt=y*h+s*w+p*c-h*w-s*p-y*c,it=f*p+y*o+e*w-p*o-y*e-f*w,rt=f*h*w+s*p*o+y*e*c-y*h*o-s*e*w-f*p*c;u.transform(d/b,tt/b,g/b,it/b,nt/b,rt/b);u.drawImage(n,0,0);u.stroke();u.restore()}return this},n}();Noc.Collision.circularDetection=function(n,t){var i=n.x-t.x,r=n.y-t.y,u=n.r+t.r;return i*i+r*r<=u*u};Noc.Collision.rectangularDetection=function(n,t){return n.x<t.x+t.w&&n.x+n.w>t.x&&n.y<t.y+t.h&&n.h+n.y>t.y?!0:!1};Noc.Audio=function(){function n(){var n=this;this.audioBuffers={};this.keys=[];this.context=new AudioContext;this.load=function(t,i){this.keys.unshift(t);var r=new XMLHttpRequest;return r.open("GET",i,!0),r.responseType="arraybuffer",r.onload=function(){n.context.decodeAudioData(r.response,function(i){n.audioBuffers[t]=i;n.completed&&n.completed(t)},function(n){console.log(n)})},r.send(),this}}return n.prototype.completed=function(){},n.prototype.play=function(n,t){var i=this.context.createBufferSource();return i.buffer=this.audioBuffers[n],i.connect(this.context.destination),i.start(),t&&t(i),this},n.prototype.pause=function(){},n}();Noc.Geometry=function(){var n=function(){this.name="";this.verticles=[];this.faces=[];this.faceVertexUvs=[[]];this.color="#ffffff"};return n.prototype.hasFaceVertexUv=function(){return this.faceVertexUvs[0]&&this.faceVertexUvs[0].length>0},n.prototype.hasFaceVertexUv2=function(){return this.faceVertexUvs[1]&&this.faceVertexUvs[1].length>0},n}();Noc.Face=function(){return function(n,t,i){this.a=n;this.b=t;this.c=i;this.materialIndex=0;this.vertexNormals={}}}();Noc.Timer.Fps=function(){var n=function(){this.elapsed=0;this.last=null};return n.prototype.tick=function(n){this.elapsed=n-(this.last||n)/1e3;this.last=n},n.prototype.current=function(){return Math.round(1/this.elapsed)},n}();Noc.Sprite=function(){function n(n,t,i,r,u,f,e){this.image=n;this.pos=t;this.size=i;this.speed=typeof r=="number"?r:0;this.frames=u;this._index=0;this.dir=f||"horizontal";this.once=e}return n.prototype.update=function(n){this._index+=this.speed*n},n.prototype.render=function(n,t){var i,r,u,f,e;if(Math.floor(this._index)>=this.frames.length&&t&&t(),this.speed>0){if(r=this.frames.length,u=Math.floor(this._index),i=this.frames[u%r],this.once&&u>=r){this.done=!0;return}}else i=0;f=this.pos[0];e=this.pos[1];this.dir=="vertical"?e+=i*this.size[1]:f+=i*this.size[0];n.drawImage(this.image,f,e,this.size[0],this.size[1],0,0,this.size[0],this.size[1])},n}();Noc.Images=function(){var n=function(){this.downloadQueue=[];this.successCount=0;this.errorCount=0;this.cache={}};return n.prototype.downloadAll=function(n){var t;for(this.downloadQueue.length===0&&n(),t=0;t<this.downloadQueue.length;t++){var u=this.downloadQueue[t],i=new Image,r=this;i.addEventListener("load",function(){r.successCount+=1;r.isDone()&&n()},!1);i.addEventListener("error",function(){r.errorCount+=1;r.isDone()&&n()},!1);i.src=u;this.cache[u]=i}},n.prototype.getAsset=function(n){return this.cache[n]},n.prototype.isDone=function(){return this.downloadQueue.length==this.successCount+this.errorCount},n}();Noc.BitMap=function(){return function(n,t,i){this.image=n;this.width=t;this.height=i}}();Noc.Assets=function(){var n=function(n,t){var i=this;this.imageAssets=new Noc.Images;this.audioAssets=new Noc.Audio;n.images.forEach(function(n){i.imageAssets.downloadQueue.push(n)});this.imageAssets.downloadAll(function(){t&&t()})};return n.prototype.getImage=function(n){var t=n;return this.imageAssets.cache[n]},n.prototype.getImageData=function(n){var t=this.getImage(n),i=document.createElement("canvas"),r;return i.width=t.width,i.height=t.height,r=i.getContext("2d"),r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height)},n}();Noc.Engine=function(){var n=function(n,t,i){var r=this,u,f;this.viewport={canvas:document.querySelector(n),height:0,width:0,ctx:document.querySelector(n).getContext("2d"),mouse:undefined};this.drawing=new Noc.Drawing(this.getContext());this.viewport.width=i?i.clientWidth:this.viewport.canvas.width;this.viewport.height=i?i.clientHeight:this.viewport.canvas.height;this.viewport.canvas.width=i?i.clientWidth:this.viewport.canvas.width;this.viewport.canvas.height=i?i.clientHeight:this.viewport.canvas.height;this.fps=new Noc.Timer.Fps;this.onFrame=function(){};this.parent=i;this.entities=[];this.isReady=!1;this.scenes=[];this.world=t||{width:this.viewport.width,height:this.viewport.height};this.camera=new Noc.Camera(0,0,this.viewport.width,this.viewport.height,this.world.width,this.world.height);this.clear=function(){this.viewport.ctx.clearRect(0,0,this.viewport.width,this.viewport.height)};u=Date.now();f=function(n){r.clear();var t=Date.now(),i=(t-u)/1e3;r.fps.tick(i);r.entities.forEach(function(t,u){if(t.onRender)t.onRender(t.state,key,u);if(t.collidesWith.forEach(function(i){r.entities.filter(function(n){return n.type===i}).forEach(function(i){var u=i.collitionExpression(i.state),f=t.collitionExpression(t.state),r=Noc.Collision[t.collitionDetector](u,f);t.collided=r;r&&(t.onCollition,t.onCollition.apply(t,[n,i,t]),i.onCollition,i.onCollition.apply(i,[n,t,i]))})}),(t.push<=r.timeElapsed||t.push==0)&&(t.draw(r.viewport,i,n),t.lifetime&&n>t.lifetime&&t.onLifetimeend)){t.active=!1;t.onLifetimeend(t.key,n)}});r.camera&&r.camera.update();u=t};window.addEventListener("resize",function(n){r.parent?(r.viewport.canvas.height=r.parent.offsetHeight,r.viewport.canvas.width=r.parent.offsetWidth):(r.viewport.canvas.height=n.target.innerHeight,r.viewport.canvas.width=n.target.innerWidth)},!1),function e(n){requestAnimFrame(e);r.isReady&&(f(n),r.timeElapsed=n,r.onFrame&&r.onFrame.apply(r,[n,r.fps]))}();this.resize=function(){var n=document.createEvent("UIEvents");n.initUIEvent("resize",!0,!1,window,0);window.dispatchEvent(n)}};return n.prototype.getContext=function(){return this.viewport.ctx},n.prototype.addEntity=function(n,t){return n._engine=this,n.lifetime+=this.timeElapsed||0,this.entities.push(n),t&&t(),this},n.prototype.addEntities=function(){for(var t,n=0;n<arguments.length;n++)if(t=arguments[n],t instanceof Noc.Entity)this.addEntity(t);else throw"argument "+n+" is not an instance of  Noc.Entity";},n.prototype.registerEntities=function(n,t){var i=this;n.forEach(function(n){i.addEntity(n)});t&&t()},n.prototype.addScene=function(){throw"Not yet implemented";},n.prototype.removeScene=function(){throw"Not yet implemented";},n.prototype.start=function(){this.isReady=!this.isReady},n.prototype.stop=function(){this.isReady=!1},n.prototype.removeEntity=function(n,t){var i=this.entities.findIndex(function(t){return t.id===n.id});return this.entities.remove(i),t&&t(),this},n}();Noc.Entity=function(){var n=function(n,t,i,r){this._engine=undefined;this.type="";this.id=Noc.Utils.newGuid();this.active=!0;this.state={};this.render=t;this.key=n;this.visible=!0;this.push=i|0;this.lifetime=r;this.collitionDetector="circularDetection";this.setCollitionDetector=function(n){return this.collitionDetector=n,this};this.setType=function(n){return this.type=n,this};this.toggle=function(){this.visible=!this.visible};this.init=function(n){return this.state=n,this};this.setState=function(n){return this.state=n,this};this.collidesWith=[];this.collitionExpression=function(){return this.state};this.collided=!1;this.onCollition=undefined;this.onRender=undefined;this.onLifetimeend=null};return n.prototype.draw=function(n,t,i){this.render(n,t,i)},n}();Noc.Boundary=function(){var n=function(n,t,i,r){this.left=n||0;this.top=t||0;this.width=i||0;this.height=r||0;this.right=this.left+this.width;this.bottom=this.top+this.height};return n.prototype.set=function(n,t,i,r){this.left=n;this.top=t;this.width=i||this.width;this.height=r||this.height;this.right=this.left+this.width;this.bottom=this.top+this.height},n.prototype.within=function(n){return n.left<=this.left&&n.right>=this.right&&n.top<=this.top&&n.bottom>=this.bottom},n.prototype.overlaps=function(n){return this.left<n.right&&n.left<this.right&&this.top<n.bottom&&n.top<this.bottom},n}();Noc.Camera=function(){var n={NONE:"none",HORIZONTAL:"horizontal",VERTICAL:"vertical",BOTH:"both"},t=function(t,i,r,u,f,e){this.xView=t||0;this.yView=i||0;this.xDeadZone=0;this.yDeadZone=0;this.wView=r;this.hView=u;this.axis=n.BOTH;this.followed=null;this.viewportRect=new Noc.Boundary(this.xView,this.yView,this.wView,this.hView);this.worldRect=new Noc.Boundary(0,0,f,e)};return t.prototype.follow=function(n,t,i){this.followed=n;this.xDeadZone=t||this.wView/2;this.yDeadZone=i||this.hView/2},t.prototype.update=function(){this.followed!=null&&((this.axis==n.HORIZONTAL||this.axis==n.BOTH)&&(this.followed.x-this.xView+this.xDeadZone>this.wView?this.xView=this.followed.x-(this.wView-this.xDeadZone):this.followed.x-this.xDeadZone<this.xView&&(this.xView=this.followed.x-this.xDeadZone)),(this.axis==n.VERTICAL||this.axis==n.BOTH)&&(this.followed.y-this.yView+this.yDeadZone>this.hView?this.yView=this.followed.y-(this.hView-this.yDeadZone):this.followed.y-this.yDeadZone<this.yView&&(this.yView=this.followed.y-this.yDeadZone)));this.viewportRect.set(this.xView,this.yView);this.viewportRect.within(this.worldRect)||(this.viewportRect.left<this.worldRect.left&&(this.xView=this.worldRect.left),this.viewportRect.top<this.worldRect.top&&(this.yView=this.worldRect.top),this.viewportRect.right>this.worldRect.right&&(this.xView=this.worldRect.right-this.wView),this.viewportRect.bottom>this.worldRect.bottom&&(this.yView=this.worldRect.bottom-this.hView))},t}();Noc.Colors={blendColors:function(n,t,i){var r=parseInt(n.slice(1),16),u=parseInt(t.slice(1),16),f=r>>16,e=r>>8&255,o=r&255,s=u>>16,h=u>>8&255,c=u&255;return"#"+(16777216+(Math.round((s-f)*i)+f)*65536+(Math.round((h-e)*i)+e)*256+(Math.round((c-o)*i)+o)).toString(16).slice(1)}};$=$||function(n,t){return t||(t=document),t.querySelector(n)},function(){Array.prototype.interpolate=function(n){var t=this,e=function(n,t,i){return n+(t-n)*i},r=[],o=new Number((t.length-1)/(n-1)),i;for(r[0]=t[0],i=1;i<n-1;i++){var u=i*o,f=new Number(Math.floor(u)).toFixed(),s=new Number(Math.ceil(u)).toFixed(),h=u-f;r[i]=e(t[f],t[s],h)}return r[n-1]=t[t.length-1],r};Array.prototype.first=function(n){return n?(n<0&&(n=0),this.slice(0,n)):this[0]};Array.prototype.take=function(n){return n||(n=2),this.filter(function(t,i){if(i<n)return t})||[]};Array.prototype.findBy=function(n){for(var i=this,r=[],t=0;t<i.length;t++)n(i[t])&&r.push(i[t]);return r};Array.prototype.count=function(n){var r=this,i=0,t;if(!n)return this.length;for(t=0;t<this.length;t++)n(r[t])&&i++;return i};Array.prototype.findIndex=function(n){for(var i=this,t=0;t<this.length;t++)if(n(i[t]))return t;return-1};Array.prototype.remove=function(n){return this.splice(n,1),this.length};Array.prototype.clone=function(){return this.slice(0)};Array.prototype.removeAll=function(){for(var n=0;this.length;n++)this.splice(n,1);return this.length}}();
//# sourceMappingURL=noc.engine.latest.min.js.map
